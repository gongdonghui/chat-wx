# 检索精度优化总结

## 优化内容

### 1. RRF融合升级
- **改进前**：仅支持两个检索结果的融合
- **改进后**：支持多个检索结果的融合
- **参数调整**：k值从60调整为50，增加相关文档的权重

### 2. 关键词增强检索
- **使用工具**：jieba分词库
- **策略**：
  - 提取查询中的关键词（长度>1）
  - 计算文档与关键词的匹配得分
  - 作为第三个检索源参与融合

### 3. 相似度阈值过滤
- **策略**：向量检索结果归一化后，仅保留相似度≥0.2的结果
- **优势**：过滤不相关的文档，提高检索精度

### 4. 参数化配置
- **TOP_N**：每个检索方法取前10个结果
- **FINAL_TOP_N**：最终返回前5个最相关文档
- **SIMILARITY_THRESHOLD**：向量检索相似度阈值0.2

## 测试结果

### 关键词提取
```
查询: 什么是人工智能？ → 关键词: ['什么', '人工', '智能', '人工智能']
查询: 机器学习和深度学习的区别 → 关键词: ['机器', '学习', '深度', '学习', '区别']
查询: 如何优化RAG系统的检索精度 → 关键词: ['如何', '优化', 'RAG', '系统', '检索', '精度']
```

### 相似度转换
```
L2距离: 0.00 → 相似度: 1.0000
L2距离: 0.50 → 相似度: 0.6667
L2距离: 1.00 → 相似度: 0.5000
L2距离: 2.00 → 相似度: 0.3333
```

### RRF融合
```
融合后结果:
文档 1: 得分 0.0592
文档 0: 得分 0.0585
文档 2: 得分 0.0388
文档 3: 得分 0.0381
```

## 使用方法

服务器启动后，通过`/rag/query`接口即可使用优化后的检索功能。

```bash
curl -X POST http://localhost:5000/rag/query -F "query=你的问题"
```
